<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI –¢—Ä–µ–Ω–∞–∂—ë—Ä | –ó–∞—É—á–∏–≤–∞–Ω–∏–µ</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- –§–æ–Ω–æ–≤—ã–µ —Ñ–∏–≥—É—Ä—ã -->
  <svg class="background-shapes" viewBox="0 0 1200 120" preserveAspectRatio="none">
    <path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25" fill="#3498db"></path>
    <path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c35.07-11.74,72-44.76,108.88-34.26,36.74,10.45,73.22,7.21,110.23-12.23,36.12-18.96,70.55-49.94,115.17-48.09,19.57.78,38.81,18.64,57.34,9.43C750.37,6.39,812.99,18.24,879.71,2.83C948.34-13.08,1017.47-32.31,1089.68-18.45C1162.03-4.34,1230.07,21.56,1200,52.47V0Z" opacity=".25" fill="#27ae60"></path>
  </svg>

  <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
  <h1 class="floating">üß† AI –¢—Ä–µ–Ω–∞–∂—ë—Ä</h1>

  <div class="progress-container">
    <div class="progress-bar">
      <div id="progress-fill" class="progress-fill"></div>
    </div>
    <div class="progress-text" id="progress-text">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 51</div>
  </div>

  <div class="stats">
    –ü—Ä–∞–≤–∏–ª—å–Ω–æ: <span id="correct-count">0</span> –∏–∑ <span id="total-count">51</span>
  </div>

  <div class="card" id="quiz-card"></div>

  <script src="questions.js"></script>
  <script>
    // === –ó–í–£–ö (—Ç–∏—Ö–∏–π –ø–ª–∏–Ω–∫) ===
    function playSuccessSound() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.frequency.value = 600;
        gain.gain.value = 0.1;
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.3);
        osc.stop(ctx.currentTime + 0.3);
      } catch (e) { /* ignore */ }
    }

    // === –ò–ö–û–ù–ö–ò ===
    const iconPaths = {
      software1: 'icons/software1.svg',
      software2: 'icons/software2.svg',
      software3: 'icons/software3.svg',
      git: 'icons/git.svg',
      cicd: 'icons/cicd.svg',
      llm: 'icons/llm.svg',
      markdown: 'icons/markdown.svg',
      coding: 'icons/coding.svg',
      agent: 'icons/agent.svg'
    };

    // === –õ–û–ì–ò–ö–ê ===
    let currentIndex = parseInt(localStorage.getItem('quiz_currentIndex')) || 0;
    let correctCount = parseInt(localStorage.getItem('quiz_correctCount')) || 0;
    let userAnswers = JSON.parse(localStorage.getItem('quiz_userAnswers')) || new Array(questions.length).fill(null);

    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('quiz_theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
      }
      renderQuestion();
    });

    function saveToStorage() {
      localStorage.setItem('quiz_currentIndex', currentIndex.toString());
      localStorage.setItem('quiz_correctCount', correctCount.toString());
      localStorage.setItem('quiz_userAnswers', JSON.stringify(userAnswers));
    }

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('quiz_theme', isDark ? 'dark' : 'light');
    }

    function renderQuestion() {
      if (currentIndex >= questions.length) {
        showFinal();
        return;
      }

      const q = questions[currentIndex];
      const iconPath = iconPaths[q.icon] || iconPaths.software1;
      const progressPercent = Math.round((currentIndex / questions.length) * 100);
      document.getElementById('progress-fill').style.width = `${progressPercent}%`;
      document.getElementById('progress-text').textContent = `–í–æ–ø—Ä–æ—Å ${currentIndex + 1} –∏–∑ ${questions.length}`;
      document.getElementById('correct-count').textContent = correctCount;
      document.getElementById('total-count').textContent = questions.length;

      document.getElementById('quiz-card').innerHTML = `
        <div class="question">
          <img src="${iconPath}" class="question-icon" alt="icon">
          ${q.q}
        </div>
        <textarea id="user-answer" placeholder="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –ø–æ –ø–∞–º—è—Ç–∏..."></textarea>
        <div>
          <button class="btn btn-back" ${currentIndex === 0 ? 'disabled' : ''} onclick="goBack()">‚¨Ö –ù–∞–∑–∞–¥</button>
          <button class="btn btn-show" onclick="showAnswer()">–ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–∞–ª–æ–Ω</button>
        </div>
        <div id="answer-box" class="answer-box"></div>
        <div id="feedback-area"></div>
      `;

      document.getElementById('user-answer').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          showAnswer();
        }
      });
    }

    function showAnswer() {
      const q = questions[currentIndex];
      document.getElementById('answer-box').innerHTML = `<strong>–≠—Ç–∞–ª–æ–Ω:</strong> ${q.a}`;
      document.getElementById('answer-box').style.display = 'block';

      const hasAnswered = userAnswers[currentIndex] !== null;
      if (hasAnswered) {
        const wasCorrect = userAnswers[currentIndex];
        document.getElementById('feedback-area').innerHTML = `
          <p><strong>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞:</strong> ${wasCorrect ? '‚úÖ –í–µ—Ä–Ω–æ' : '‚ùå –ù–µ–≤–µ—Ä–Ω–æ'}</p>
          <button class="btn btn-right" onclick="recordResult(true)">–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ ‚úÖ –í–µ—Ä–Ω–æ</button>
          <button class="btn btn-wrong" onclick="recordResult(false)">–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ ‚ùå –ù–µ–≤–µ—Ä–Ω–æ</button>
          <button class="btn btn-next" onclick="nextQuestion()">‚û° –°–ª–µ–¥—É—é—â–∏–π</button>
        `;
      } else {
        document.getElementById('feedback-area').innerHTML = `
          <button class="btn btn-right" onclick="recordResult(true)">‚úÖ –í–µ—Ä–Ω–æ</button>
          <button class="btn btn-wrong" onclick="recordResult(false)">‚ùå –ù–µ–≤–µ—Ä–Ω–æ</button>
          <button class="btn btn-next" onclick="nextQuestion()">‚û° –°–ª–µ–¥—É—é—â–∏–π</button>
        `;
      }
    }

    function recordResult(isCorrect) {
      const wasCorrect = userAnswers[currentIndex];
      if (wasCorrect !== isCorrect) {
        if (wasCorrect === true) correctCount--;
        if (isCorrect) {
          correctCount++;
          playSuccessSound();
          const btn = document.querySelector('.btn-right');
          const original = btn.innerHTML;
          btn.innerHTML = '‚úÖ';
          btn.classList.add('pop');
          setTimeout(() => {
            btn.innerHTML = original;
            btn.classList.remove('pop');
          }, 600);
        }
      }
      userAnswers[currentIndex] = isCorrect;
      saveToStorage();
      document.getElementById('correct-count').textContent = correctCount;
    }

    function nextQuestion() {
      currentIndex++;
      saveToStorage();
      renderQuestion();
    }

    function goBack() {
      if (currentIndex > 0) {
        currentIndex--;
        saveToStorage();
        renderQuestion();
      }
    }

    function showFinal() {
      const percent = Math.round((correctCount / questions.length) * 100);
      document.getElementById('quiz-card').innerHTML = `
        <div class="final">üèÜ –¢—ã –º–æ–ª–æ–¥–µ—Ü!</div>
        <div class="final-score">${correctCount} –∏–∑ ${questions.length}<br>(${percent}%)</div>
        <div style="text-align:center; margin-top:20px;">
          <button class="btn btn-show" onclick="location.reload()">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
          <button class="btn btn-reset" onclick="resetProgress()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
        </div>
      `;
    }

    function resetProgress() {
      localStorage.removeItem('quiz_currentIndex');
      localStorage.removeItem('quiz_correctCount');
      localStorage.removeItem('quiz_userAnswers');
      currentIndex = 0;
      correctCount = 0;
      userAnswers = new Array(questions.length).fill(null);
      renderQuestion();
    }
  </script>
</body>
</html>